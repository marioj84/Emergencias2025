<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz - Marca respuestas correctas/incorrectas</title>
  <style>
    :root{
      --bg:#071124;
      --text:#e6eef8;
      --box:#0f2230;
      --box-strong:rgba(255,255,255,0.03);
      --green-bg: rgba(46,204,113,0.12);
      --green-border: rgba(46,204,113,0.85);
      --red-bg: rgba(231,76,60,0.10);
      --red-border: rgba(231,76,60,0.85);
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
      padding: 20px;
    }

    /* Pregunta */
    .question {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.03);
    }
    .question h4 { margin:0 0 10px 0; font-size:14px; color:var(--text); }

    /* Opciones (cajas) */
    .options { display:flex; flex-direction:column; gap:8px; }
    .option-label {
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:8px;
      background: var(--box);
      border: 1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      transition: background .18s ease, border-color .18s ease, transform .05s ease;
      user-select:none;
    }
    .option-label input { transform:translateY(1px); }

    .option-label:hover { transform: translateY(-1px); }

    /* Estado correcto / incorrecto */
    .option-label.correct {
      background: var(--green-bg) !important;
      border-color: var(--green-border) !important;
      box-shadow: 0 4px 14px rgba(46,204,113,0.06);
    }
    .option-label.incorrect {
      background: var(--red-bg) !important;
      border-color: var(--red-border) !important;
      box-shadow: 0 4px 14px rgba(231,76,60,0.06);
    }

    /* Progreso (peque√±o) */
    #quiz-progress-container { margin-top: 10px; max-width: 900px; }
    #quiz-progress-text { font-size:13px; margin-bottom:6px; opacity:0.95; }
    #quiz-progress-bar { width:100%; height:12px; background: rgba(255,255,255,0.06); border-radius:8px; overflow:hidden; }
    #quiz-progress-fill { height:100%; width:0%; transition: width 350ms ease; background: linear-gradient(90deg, rgba(46,204,113,0.9), rgba(52,152,219,0.9)); }

    /* Botones bloqueo/config */
    #quiz-lock-toggle, #quiz-set-password {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      color: var(--text);
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      margin-top:8px;
    }
  </style>
</head>
<body>

  <!-- EJEMPLO: preguntas (pon aqu√≠ tus preguntas reales).
       Importante: cada .question debe tener data-correct con la letra correcta (A,B,C...) -->
  <div class="question" data-qid="11" data-correct="A">
    <h4>11. CUANDO A UN TRIPULANTE LE CORRESPONDE UN DESCANSO M√çNIMO (10 HORAS), SE DEBER√Å CONSIDERAR UN TIEMPO ADICIONAL DE 45 MINUTOS PARA EFECTOS DE TRASLADO... </h4>
    <div class="options">
      <label class="option-label"><input type="radio" name="q11" value="A"> VERDADERO</label>
      <label class="option-label"><input type="radio" name="q11" value="B"> FALSO</label>
    </div>
  </div>

  <div class="question" data-qid="12" data-correct="B">
    <h4>12. Otra pregunta de ejemplo</h4>
    <div class="options">
      <label class="option-label"><input type="radio" name="q12" value="A"> Opci√≥n A</label>
      <label class="option-label"><input type="radio" name="q12" value="B"> Opci√≥n B</label>
      <label class="option-label"><input type="radio" name="q12" value="C"> Opci√≥n C</label>
    </div>
  </div>

  <!-- BARRA DE PROGRESO -->
  <div id="quiz-progress-container" aria-live="polite" style="max-width:900px;">
    <div id="quiz-progress-text">Respondido: 0/0 (0%) ‚Äî Falta: 0</div>
    <div id="quiz-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
      <div id="quiz-progress-fill" style="width:0%"></div>
    </div>

    <div>
      <button id="quiz-lock-toggle">üîí Modo solo lectura (bloqueado)</button>
      <button id="quiz-set-password" title="Configurar contrase√±a">‚öôÔ∏è Set pass</button>
    </div>
  </div>

  <script>
    (function(){
      // Selectores
      const QUESTION_SELECTOR = '.question';
      const OPTION_LABEL_SELECTOR = '.option-label';
      const RADIO_SELECTOR = 'input[type="radio"]';

      // Progreso UI
      const progressText = document.getElementById('quiz-progress-text');
      const progressFill = document.getElementById('quiz-progress-fill');

      // Lock keys (misma l√≥gica anterior)
      const LOCK_KEY = 'quiz_edit_locked_v1';
      const PASS_KEY = 'quiz_edit_pass_v1';
      const lockToggleBtn = document.getElementById('quiz-lock-toggle');
      const setPassBtn = document.getElementById('quiz-set-password');

      /* ---------- Funciones de progreso ---------- */
      function updateProgress(){
        const questions = Array.from(document.querySelectorAll(QUESTION_SELECTOR));
        const total = questions.length;
        let answered = 0;
        questions.forEach(q => {
          const anyChecked = q.querySelector(RADIO_SELECTOR + ':checked');
          if (anyChecked) answered++;
        });
        const pct = total === 0 ? 0 : Math.round((answered / total) * 10000) / 100;
        const remaining = total - answered;
        progressText.innerText = `Respondido: ${answered}/${total} (${pct}%) ‚Äî Falta: ${remaining}`;
        progressFill.style.width = pct + '%';
        progressFill.parentElement.setAttribute('aria-valuenow', pct);
      }

      /* ---------- Marcaci√≥n correcta/incorrecta ---------- */
      function evaluateQuestion(questionEl){
        // Q tiene data-correct (letra). Si no existe, no hace nada.
        const correct = (questionEl.getAttribute('data-correct') || '').toString().trim().toUpperCase();
        if (!correct) {
          // limpiar marcas si antes exist√≠an
          questionEl.querySelectorAll(OPTION_LABEL_SELECTOR).forEach(l => l.classList.remove('correct','incorrect'));
          return;
        }
        const checked = questionEl.querySelector(RADIO_SELECTOR + ':checked');
        // limpiar marcas anteriores
        questionEl.querySelectorAll(OPTION_LABEL_SELECTOR).forEach(l => l.classList.remove('correct','incorrect'));
        if (!checked) return;
        const selectedVal = (checked.value || '').toString().trim().toUpperCase();

        // marca la correcta siempre (si existe)
        const correctInput = questionEl.querySelector(RADIO_SELECTOR + `[value="${correct}"]`);
        if (correctInput) {
          const correctLabel = correctInput.closest('label') || correctInput.parentElement;
          if (correctLabel) correctLabel.classList.add('correct');
        }

        // si seleccion√≥ incorrecta, marca la seleccionada como incorrecta
        if (selectedVal !== correct) {
          const selectedLabel = checked.closest('label') || checked.parentElement;
          if (selectedLabel) selectedLabel.classList.add('incorrect');
        } else {
          // si seleccion√≥ la correcta, la etiqueta seleccionada ya tiene .correct por la l√≠nea anterior
          const selectedLabel = checked.closest('label') || checked.parentElement;
          if (selectedLabel) selectedLabel.classList.add('correct');
        }
      }

      /* Recalcula para todas las preguntas (√∫til en init y en import)*/
      function evaluateAllQuestions(){
        const questions = Array.from(document.querySelectorAll(QUESTION_SELECTOR));
        questions.forEach(q => evaluateQuestion(q));
      }

      /* ---------- Evento: cuando cambia una opci√≥n ---------- */
      document.addEventListener('change', function(e){
        if (!e.target || !e.target.matches(RADIO_SELECTOR)) return;
        const q = e.target.closest(QUESTION_SELECTOR);
        if (!q) return;
        evaluateQuestion(q);
        updateProgress();
      }, true);

      /* Also update when page navigation buttons used (if exist) */
      document.addEventListener('click', function(e){
        const t = e.target;
        if (!t) return;
        const txt = (t.innerText || '').toLowerCase();
        if (txt.includes('siguiente') || txt.includes('anterior') || txt.includes('next') || txt.includes('prev')) {
          setTimeout(() => { evaluateAllQuestions(); updateProgress(); }, 250);
        }
      });

      /* ---------- Ocultar controles peligrosos (si quieres) ---------- */
      function hideButtonsByText(texts) {
        const buttons = Array.from(document.querySelectorAll('button, a, input[type="button"], .btn, .button'));
        texts.forEach(txt => {
          buttons.forEach(b => {
            if (!b) return;
            const label = (b.innerText || b.value || '').trim().toLowerCase();
            if (label.includes(txt.toLowerCase())) {
              b.style.display = 'none';
              b.disabled = true;
              b.onclick = (ev)=>{ ev.preventDefault(); ev.stopPropagation(); return false; };
            }
          });
        });
      }
      function hideModeControls(){
        hideButtonsByText(['modo edici√≥n','modo edicion','editar','importar respuestas','importar']);
      }

      /* ---------- Lock simple (localStorage) ---------- */
      function isLocked(){ const val = localStorage.getItem(LOCK_KEY); return val === null ? true : (val === '1'); }
      function setLocked(val){ localStorage.setItem(LOCK_KEY, val ? '1' : '0'); renderLockBtn(); if (val) hideModeControls(); }
      function renderLockBtn(){
        if (!lockToggleBtn) return;
        const locked = isLocked();
        lockToggleBtn.textContent = locked ? 'üîí Modo solo lectura (bloqueado)' : 'üîì Edici√≥n ACTIVA';
        lockToggleBtn.setAttribute('aria-pressed', (!locked).toString());
      }
      function promptToUnlock(){
        const stored = localStorage.getItem(PASS_KEY);
        if (!stored) { alert('No hay contrase√±a configurada. Usa "Set pass" para crearla.'); return; }
        const pass = prompt('Introduce la contrase√±a para desbloquear la edici√≥n:');
        if (pass === null) return;
        if (pass === stored) { setLocked(false); alert('Edici√≥n desbloqueada.'); }
        else alert('Contrase√±a incorrecta.');
      }
      function setPasswordFlow(){
        const newPass = prompt('Define la contrase√±a de edici√≥n (gu√°rdala en un lugar seguro).');
        if (!newPass) return;
        localStorage.setItem(PASS_KEY, newPass);
        alert('Contrase√±a guardada en este navegador.');
      }

      /* ---------- Inicializaci√≥n ---------- */
      function init(){
        evaluateAllQuestions();
        updateProgress();
        setInterval(updateProgress, 1000);

        if (lockToggleBtn) {
          lockToggleBtn.addEventListener('click', function(){
            if (isLocked()) promptToUnlock();
            else if (confirm('¬øQuieres bloquear la edici√≥n?')) setLocked(true);
          });
        }
        if (setPassBtn) setPassBtn.addEventListener('click', setPasswordFlow);

        // hide possible edit/import controls
        hideModeControls();
        renderLockBtn();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else init();

    })();
  </script>

</body>
</html>
